# applicative microservices
microservices:
  - name: groups-microservice
    dockerfile: ./microservices/groups_microservice/Dockerfile
  - name: users-microservice
    dockerfile: ./microservices/groups_microservice/Dockerfile
build:
  expand:
    - variable: PIPE_BUILD_ENV_FILE
      type: environment
  registry: '@name@'
deployments:
  default:
    expand:
      - variable: PIPE_${ENV}_ENV_FILE
        type: environment
      - variable: 'PIPE_${ENV}_PLATFORM_ENV_FILE'
        name: platform
        type: file
        file_name: protocols
      - variable:  'PIPE_${ENV}_PROTOCOLS_ENV_FILE'
        name: protocols
        type: file
    registry: '@name@-@promotion-env@'
    scripts:
      pre_execution: 'echo "Pipeline is about to start..."'
      post_execution:  'echo "Pipeline completed..."'
    helm:
      parameters: --set env.platform="$(base64 -w 0 ./platform.env)" --set env.protocols="$(base64 -w 0 ./protocols.env)"
