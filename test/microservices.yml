# applicative microservices
microservices:
  - name: contoflow-protocols-webapp
    dockerfile: ./microservices/contoflow_protocols/webapp/Dockerfile
build:
  expand:
    - variable: PIPE_BUILD_ENV_FILE
      type: environment
  registry: '@name@'
deployments:
  default:
    expand:
      - variable: PIPE_${ENV}_ENV_FILE
        type: environment
      - variable: 'PIPE_${ENV}_PLATFORM_ENV_FILE'
        name: platform
        type: file
        file_name: protocols
      - variable:  'PIPE_${ENV}_PROTOCOLS_ENV_FILE'
        name: protocols
        type: file
    registry: '@promotion-env@-@name@'
    scripts:
      pre_execution: ''
      pre_deployment: 'source ./database/scripts/deployment.sh'
      post_deployment: ''
      post_execution:  ''
    helm:
      parameters: --set env.platform="$(base64 -w 0 ./platform.env)" --set env.protocols="$(base64 -w 0 ./protocols.env)"
