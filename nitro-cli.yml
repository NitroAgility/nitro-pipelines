version: 1
workspace:
  id: 29574a8da297575bb157ba6fa80d57da
  name: nitro-pipelines
commands:
  - name: provision
    description: Provision the environment
    steps:
      - scripts: 
          - pyenv virtualenv 3.9.6 nitro-pipelines-3.9.6 || pip install --upgrade pip || pip install -r requirements.txt
  - name: destroy
    description: Destroy the environment
    steps:
      - script: pyenv uninstall -f nitro-pipelines-3.9.6
  - name: test-build
    description: test
    steps:
      - cwd: .
        scripts: 
          - export NITRO_PIPELINES_MICROSERVICES_PATH=./test/microservices.yml && ./bitbucket/pipe/nitro-pipe build groups-microservice
  - name: test-deploy
    description: test
    steps:
      - cwd: .
        scripts: 
          - export ENV=DEV && export NITRO_PIPELINES_MICROSERVICES_PATH=./test/microservices.yml && ./bitbucket/pipe/nitro-pipe deploy
  - name: build
    description: Build the docker image
    steps: 
      - script: docker build -t nitroagility/nitro-bitbucket-pipelines:58 -f ./bitbucket/Dockerfile .
  - name: push
    description: Build the docker image
    steps:
      - script: docker push nitroagility/nitro-bitbucket-pipelines:58